<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGG for Rust — Interactive Demos</title>
  <link rel="stylesheet" href="./styles/main.css">
</head>
<body>
  <nav id="sidebar">
    <div class="sidebar-header">
      <h1 class="logo">AGG<span class="logo-accent">.rs</span></h1>
      <p class="tagline">Anti-Grain Geometry for Rust</p>
    </div>
    <div class="sidebar-actions">
      <button id="expand-all-btn" class="expand-all-btn" title="Expand or collapse all sections">Expand All</button>
      <div class="search-box">
        <span class="search-icon">&#128269;</span>
        <input id="nav-search" type="text" class="search-input" placeholder="Search demos..." autocomplete="off" spellcheck="false">
        <button id="search-clear" class="search-clear" title="Clear search" aria-label="Clear search">&times;</button>
      </div>
    </div>
    <ul class="nav-list">
      <li><a href="#/" class="nav-link active" data-route="home">
        <span class="nav-icon">&#9670;</span> Home
      </a></li>
      <li class="nav-group" data-section="anti-aliasing">
        <button class="nav-section" aria-expanded="true">Anti-Aliasing</button>
        <ul class="nav-group-items">
          <li><a href="#/aa_demo" class="nav-link" data-route="aa_demo">
            <img class="nav-thumb" src="./public/thumbnails/aa_demo_s.gif" alt=""> AA Demo
          </a></li>
          <li><a href="#/rasterizers" class="nav-link" data-route="rasterizers">
            <img class="nav-thumb" src="./public/thumbnails/rasterizers_s.gif" alt=""> Rasterizers
          </a></li>
          <li><a href="#/rasterizers2" class="nav-link" data-route="rasterizers2">
            <img class="nav-thumb" src="./public/thumbnails/rasterizers2_s.gif" alt=""> Rasterizers 2
          </a></li>
          <li><a href="#/gamma_correction" class="nav-link" data-route="gamma_correction">
            <img class="nav-thumb" src="./public/thumbnails/gamma_correction_s.gif" alt=""> Gamma
          </a></li>
          <li><a href="#/gamma_tuner" class="nav-link" data-route="gamma_tuner">
            <img class="nav-thumb" src="./public/thumbnails/gamma_tuner_s.png" alt=""> Gamma Tuner
          </a></li>
          <li><a href="#/aa_test" class="nav-link" data-route="aa_test">
            <img class="nav-thumb" src="./public/thumbnails/aa_test_s.png" alt=""> AA Test
          </a></li>
          <li><a href="#/gamma_ctrl" class="nav-link" data-route="gamma_ctrl">
            <img class="nav-thumb" src="./public/thumbnails/gamma_ctrl_s.gif" alt=""> Gamma Ctrl
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="rendering">
        <button class="nav-section" aria-expanded="false">Rendering</button>
        <ul class="nav-group-items">
          <li><a href="#/lion" class="nav-link" data-route="lion">
            <img class="nav-thumb" src="./public/thumbnails/lion_s.png" alt=""> Lion
          </a></li>
          <li><a href="#/lion_outline" class="nav-link" data-route="lion_outline">
            <img class="nav-thumb" src="./public/thumbnails/lion_outline_s.gif" alt=""> Lion Outline
          </a></li>
          <li><a href="#/perspective" class="nav-link" data-route="perspective">
            <img class="nav-thumb" src="./public/thumbnails/perspective_s.gif" alt=""> Perspective
          </a></li>
          <li><a href="#/circles" class="nav-link" data-route="circles">
            <img class="nav-thumb" src="./public/thumbnails/circles_s.gif" alt=""> Circles
          </a></li>
          <li><a href="#/shapes" class="nav-link" data-route="shapes">
            <img class="nav-thumb" src="./public/thumbnails/circles_s.gif" alt=""> Shapes
          </a></li>
          <li><a href="#/alpha_mask" class="nav-link" data-route="alpha_mask">
            <img class="nav-thumb" src="./public/thumbnails/alpha_mask_s.gif" alt=""> Alpha Mask
          </a></li>
          <li><a href="#/alpha_gradient" class="nav-link" data-route="alpha_gradient">
            <img class="nav-thumb" src="./public/thumbnails/alpha_gradient_s.png" alt=""> Alpha Gradient
          </a></li>
          <li><a href="#/alpha_mask2" class="nav-link" data-route="alpha_mask2">
            <img class="nav-thumb" src="./public/thumbnails/alpha_mask2_s.jpg" alt=""> Alpha Mask 2
          </a></li>
          <li><a href="#/alpha_mask3" class="nav-link" data-route="alpha_mask3">
            <img class="nav-thumb" src="./public/thumbnails/alpha_mask3_s.gif" alt=""> Alpha Mask 3
          </a></li>
          <li><a href="#/multi_clip" class="nav-link" data-route="multi_clip">
            <img class="nav-thumb" src="./public/thumbnails/multi_clip_s.gif" alt=""> Multi Clip
          </a></li>
          <li><a href="#/simple_blur" class="nav-link" data-route="simple_blur">
            <img class="nav-thumb" src="./public/thumbnails/simple_blur_s.gif" alt=""> Simple Blur
          </a></li>
          <li><a href="#/blur" class="nav-link" data-route="blur">
            <img class="nav-thumb" src="./public/thumbnails/blur_s.png" alt=""> Blur
          </a></li>
          <li><a href="#/lion_lens" class="nav-link" data-route="lion_lens">
            <img class="nav-thumb" src="./public/thumbnails/lion_lens_s.gif" alt=""> Lion Lens
          </a></li>
          <li><a href="#/blend_color" class="nav-link" data-route="blend_color">
            <img class="nav-thumb" src="./public/thumbnails/compositing_s.png" alt=""> Blend Color
          </a></li>
          <li><a href="#/component_rendering" class="nav-link" data-route="component_rendering">
            <img class="nav-thumb" src="./public/thumbnails/component_rendering_s.gif" alt=""> Component Rendering
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="gradients">
        <button class="nav-section" aria-expanded="false">Gradients</button>
        <ul class="nav-group-items">
          <li><a href="#/gradients" class="nav-link" data-route="gradients">
            <img class="nav-thumb" src="./public/thumbnails/gradients_s.png" alt=""> Gradients
          </a></li>
          <li><a href="#/gouraud" class="nav-link" data-route="gouraud">
            <img class="nav-thumb" src="./public/thumbnails/gouraud_s.png" alt=""> Gouraud
          </a></li>
          <li><a href="#/gouraud_mesh" class="nav-link" data-route="gouraud_mesh">
            <img class="nav-thumb" src="./public/thumbnails/gouraud_mesh_s.png" alt=""> Gouraud Mesh
          </a></li>
          <li><a href="#/gradient_focal" class="nav-link" data-route="gradient_focal">
            <img class="nav-thumb" src="./public/thumbnails/gradient_focal_s.png" alt=""> Focal Gradient
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="paths-strokes">
        <button class="nav-section" aria-expanded="false">Paths &amp; Strokes</button>
        <ul class="nav-group-items">
          <li><a href="#/conv_stroke" class="nav-link" data-route="conv_stroke">
            <img class="nav-thumb" src="./public/thumbnails/conv_stroke_s.gif" alt=""> Conv Stroke
          </a></li>
          <li><a href="#/conv_contour" class="nav-link" data-route="conv_contour">
            <img class="nav-thumb" src="./public/thumbnails/conv_contour_s.gif" alt=""> Conv Contour
          </a></li>
          <li><a href="#/conv_dash" class="nav-link" data-route="conv_dash">
            <img class="nav-thumb" src="./public/thumbnails/conv_dash_marker_s.gif" alt=""> Conv Dash
          </a></li>
          <li><a href="#/line_thickness" class="nav-link" data-route="line_thickness">
            <img class="nav-thumb" src="./public/thumbnails/conv_stroke_s.gif" alt=""> Line Thickness
          </a></li>
          <li><a href="#/conv_dash_marker" class="nav-link" data-route="conv_dash_marker">
            <img class="nav-thumb" src="./public/thumbnails/conv_dash_marker_s.gif" alt=""> Dash Marker
          </a></li>
          <li><a href="#/line_patterns" class="nav-link" data-route="line_patterns">
            <img class="nav-thumb" src="./public/thumbnails/line_patterns_s.gif" alt=""> Line Patterns
          </a></li>
          <li><a href="#/line_patterns_clip" class="nav-link" data-route="line_patterns_clip">
            <img class="nav-thumb" src="./public/thumbnails/line_patterns_clip_s.png" alt=""> Line Patterns Clip
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="curves">
        <button class="nav-section" aria-expanded="false">Curves</button>
        <ul class="nav-group-items">
          <li><a href="#/bezier_div" class="nav-link" data-route="bezier_div">
            <img class="nav-thumb" src="./public/thumbnails/bezier_div_s.png" alt=""> Bezier Div
          </a></li>
          <li><a href="#/bspline" class="nav-link" data-route="bspline">
            <img class="nav-thumb" src="./public/thumbnails/bezier_div_s.png" alt=""> B-Spline
          </a></li>
          <li><a href="#/trans_curve1" class="nav-link" data-route="trans_curve1">
            <img class="nav-thumb" src="./public/thumbnails/trans_curve1_s.gif" alt=""> Text on Curve 1
          </a></li>
          <li><a href="#/trans_curve2" class="nav-link" data-route="trans_curve2">
            <img class="nav-thumb" src="./public/thumbnails/trans_curve2_s.gif" alt=""> Text on Curve 2
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="shapes">
        <button class="nav-section" aria-expanded="false">Shapes</button>
        <ul class="nav-group-items">
          <li><a href="#/rounded_rect" class="nav-link" data-route="rounded_rect">
            <img class="nav-thumb" src="./public/thumbnails/rounded_rect_s.gif" alt=""> Rounded Rect
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="misc">
        <button class="nav-section" aria-expanded="false">Misc</button>
        <ul class="nav-group-items">
          <li><a href="#/idea" class="nav-link" data-route="idea">
            <img class="nav-thumb" src="./public/thumbnails/idea_s.gif" alt=""> Idea
          </a></li>
          <li><a href="#/trans_polar" class="nav-link" data-route="trans_polar">
            <img class="nav-thumb" src="./public/thumbnails/trans_polar_s.gif" alt=""> Polar Transform
          </a></li>
          <li><a href="#/distortions" class="nav-link" data-route="distortions">
            <img class="nav-thumb" src="./public/thumbnails/distortions_s.png" alt=""> Distortions
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="advanced">
        <button class="nav-section" aria-expanded="false">Advanced</button>
        <ul class="nav-group-items">
          <li><a href="#/graph_test" class="nav-link" data-route="graph_test">
            <img class="nav-thumb" src="./public/thumbnails/graph_test_s.gif" alt=""> Graph Test
          </a></li>
          <li><a href="#/polymorphic_renderer" class="nav-link" data-route="polymorphic_renderer">
            <img class="nav-thumb" src="./public/thumbnails/polymorphic_renderer_s.gif" alt=""> Polymorphic Renderer
          </a></li>
          <li><a href="#/scanline_boolean" class="nav-link" data-route="scanline_boolean">
            <img class="nav-thumb" src="./public/thumbnails/scanline_boolean_s.gif" alt=""> Scanline Boolean
          </a></li>
          <li><a href="#/scanline_boolean2" class="nav-link" data-route="scanline_boolean2">
            <img class="nav-thumb" src="./public/thumbnails/scanline_boolean2_s.gif" alt=""> Scanline Boolean 2
          </a></li>
          <li><a href="#/rasterizer_compound" class="nav-link" data-route="rasterizer_compound">
            <img class="nav-thumb" src="./public/thumbnails/rasterizer_compound_s.png" alt=""> Compound Rasterizer
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="compositing">
        <button class="nav-section" aria-expanded="false">Compositing</button>
        <ul class="nav-group-items">
          <li><a href="#/compositing" class="nav-link" data-route="compositing">
            <img class="nav-thumb" src="./public/thumbnails/compositing_s.png" alt=""> Compositing
          </a></li>
          <li><a href="#/compositing2" class="nav-link" data-route="compositing2">
            <img class="nav-thumb" src="./public/thumbnails/compositing2_s.png" alt=""> Compositing 2
          </a></li>
          <li><a href="#/flash_rasterizer" class="nav-link" data-route="flash_rasterizer">
            <img class="nav-thumb" src="./public/thumbnails/flash_rasterizer_s.png" alt=""> Flash Rasterizer
          </a></li>
          <li><a href="#/flash_rasterizer2" class="nav-link" data-route="flash_rasterizer2">
            <img class="nav-thumb" src="./public/thumbnails/flash_rasterizer2_s.png" alt=""> Flash Rasterizer 2
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="patterns">
        <button class="nav-section" aria-expanded="false">Patterns</button>
        <ul class="nav-group-items">
          <li><a href="#/pattern_fill" class="nav-link" data-route="pattern_fill">
            <img class="nav-thumb" src="./public/thumbnails/pattern_fill_s.gif" alt=""> Pattern Fill
          </a></li>
          <li><a href="#/pattern_perspective" class="nav-link" data-route="pattern_perspective">
            <img class="nav-thumb" src="./public/thumbnails/pattern_perspective_s.jpg" alt=""> Pattern Perspective
          </a></li>
          <li><a href="#/pattern_resample" class="nav-link" data-route="pattern_resample">
            <img class="nav-thumb" src="./public/thumbnails/pattern_resample_s.jpg" alt=""> Pattern Resample
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="text">
        <button class="nav-section" aria-expanded="false">Text</button>
        <ul class="nav-group-items">
          <li><a href="#/gsv_text" class="nav-link" data-route="gsv_text">
            <img class="nav-thumb" src="./public/thumbnails/raster_text_s.gif" alt=""> GSV Text
          </a></li>
          <li><a href="#/raster_text" class="nav-link" data-route="raster_text">
            <img class="nav-thumb" src="./public/thumbnails/raster_text_s.gif" alt=""> Raster Text
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="images-filters">
        <button class="nav-section" aria-expanded="false">Images &amp; Filters</button>
        <ul class="nav-group-items">
          <li><a href="#/image_fltr_graph" class="nav-link" data-route="image_fltr_graph">
            <img class="nav-thumb" src="./public/thumbnails/image_fltr_graph_s.gif" alt=""> Filter Graph
          </a></li>
          <li><a href="#/image1" class="nav-link" data-route="image1">
            <img class="nav-thumb" src="./public/thumbnails/image1_s.jpg" alt=""> Image Transforms
          </a></li>
          <li><a href="#/image_filters" class="nav-link" data-route="image_filters">
            <img class="nav-thumb" src="./public/thumbnails/image_filters_s.jpg" alt=""> Image Filters
          </a></li>
          <li><a href="#/image_filters2" class="nav-link" data-route="image_filters2">
            <img class="nav-thumb" src="./public/thumbnails/image_filters2_s.png" alt=""> Image Filters 2
          </a></li>
          <li><a href="#/image_perspective" class="nav-link" data-route="image_perspective">
            <img class="nav-thumb" src="./public/thumbnails/image_perspective_s.jpg" alt=""> Image Perspective
          </a></li>
          <li><a href="#/image_alpha" class="nav-link" data-route="image_alpha">
            <img class="nav-thumb" src="./public/thumbnails/image_alpha_s.png" alt=""> Image Alpha
          </a></li>
          <li><a href="#/image_transforms" class="nav-link" data-route="image_transforms">
            <img class="nav-thumb" src="./public/thumbnails/image_transforms_s.jpg" alt=""> Image Transforms
          </a></li>
          <li><a href="#/image_resample" class="nav-link" data-route="image_resample">
            <img class="nav-thumb" src="./public/thumbnails/image_resample_s.jpg" alt=""> Image Resample
          </a></li>
        </ul>
      </li>
      <li class="nav-group" data-section="molecules">
        <button class="nav-section" aria-expanded="false">Molecules</button>
        <ul class="nav-group-items">
          <li><a href="#/mol_view" class="nav-link" data-route="mol_view">
            <img class="nav-thumb" src="./public/thumbnails/mol_view_s.gif" alt=""> Mol Viewer
          </a></li>
        </ul>
      </li>
    </ul>
    <div class="sidebar-footer">
      <p><a href="https://github.com/larsbrubaker/agg-rust" target="_blank">Source on GitHub</a></p>
      <p>Rust port of <a href="http://www.antigrain.com" target="_blank">AGG 2.6</a></p>
      <p class="license">BSD-3-Clause License</p>
    </div>
  </nav>

  <main id="main-content">
    <!-- Content dynamically injected by router -->
  </main>

  <script>
    // Sidebar accordion — restore state from localStorage, default first section open
    (function() {
      var KEY = 'agg-sidebar-sections';
      var groups = document.querySelectorAll('.nav-group');
      var saved = null;
      try { saved = JSON.parse(localStorage.getItem(KEY)); } catch(e) {}

      groups.forEach(function(group, i) {
        var section = group.dataset.section;
        var btn = group.querySelector('.nav-section');
        var isOpen = saved ? !!saved[section] : i === 0;

        if (isOpen) {
          group.classList.add('open');
          btn.setAttribute('aria-expanded', 'true');
        } else {
          group.classList.remove('open');
          btn.setAttribute('aria-expanded', 'false');
        }

        btn.addEventListener('click', function() {
          var expanded = group.classList.toggle('open');
          btn.setAttribute('aria-expanded', String(expanded));
          saveState();
        });
      });

      function saveState() {
        var state = {};
        groups.forEach(function(g) {
          state[g.dataset.section] = g.classList.contains('open');
        });
        try { localStorage.setItem(KEY, JSON.stringify(state)); } catch(e) {}
      }

      // Expand All / Collapse All toggle
      var expandBtn = document.getElementById('expand-all-btn');
      function updateExpandBtnLabel() {
        var allOpen = true;
        groups.forEach(function(g) {
          if (!g.classList.contains('open')) allOpen = false;
        });
        expandBtn.textContent = allOpen ? 'Collapse All' : 'Expand All';
      }
      updateExpandBtnLabel();

      expandBtn.addEventListener('click', function() {
        var allOpen = true;
        groups.forEach(function(g) {
          if (!g.classList.contains('open')) allOpen = false;
        });
        var shouldOpen = !allOpen;
        groups.forEach(function(g) {
          var btn = g.querySelector('.nav-section');
          if (shouldOpen) {
            g.classList.add('open');
            btn.setAttribute('aria-expanded', 'true');
          } else {
            g.classList.remove('open');
            btn.setAttribute('aria-expanded', 'false');
          }
        });
        saveState();
        updateExpandBtnLabel();
      });

      // Update label when individual sections are toggled
      groups.forEach(function(group) {
        group.querySelector('.nav-section').addEventListener('click', function() {
          setTimeout(updateExpandBtnLabel, 0);
        });
      });

      // Search / filter nav items
      var searchInput = document.getElementById('nav-search');
      var searchClear = document.getElementById('search-clear');
      var allLinks = document.querySelectorAll('.nav-group-items .nav-link');

      function updateSearch() {
        var query = searchInput.value.trim().toLowerCase();
        searchClear.classList.toggle('visible', query.length > 0);

        if (!query) {
          // Restore all items and reset to saved section state
          allLinks.forEach(function(link) {
            link.closest('li').style.display = '';
          });
          groups.forEach(function(g) {
            g.style.display = '';
          });
          // Restore saved open/close state
          var restored = null;
          try { restored = JSON.parse(localStorage.getItem(KEY)); } catch(e) {}
          groups.forEach(function(g, i) {
            var section = g.dataset.section;
            var btn = g.querySelector('.nav-section');
            var isOpen = restored ? !!restored[section] : i === 0;
            if (isOpen) {
              g.classList.add('open');
              btn.setAttribute('aria-expanded', 'true');
            } else {
              g.classList.remove('open');
              btn.setAttribute('aria-expanded', 'false');
            }
          });
          updateExpandBtnLabel();
          return;
        }

        // Filter: show only matching links, auto-expand their groups
        groups.forEach(function(g) {
          var items = g.querySelectorAll('.nav-group-items .nav-link');
          var hasMatch = false;
          items.forEach(function(link) {
            var text = link.textContent.toLowerCase();
            var route = (link.dataset.route || '').toLowerCase();
            var match = text.indexOf(query) !== -1 || route.indexOf(query) !== -1;
            link.closest('li').style.display = match ? '' : 'none';
            if (match) hasMatch = true;
          });
          g.style.display = hasMatch ? '' : 'none';
          if (hasMatch) {
            g.classList.add('open');
            g.querySelector('.nav-section').setAttribute('aria-expanded', 'true');
          }
        });
      }

      searchInput.addEventListener('input', updateSearch);

      searchClear.addEventListener('click', function() {
        searchInput.value = '';
        updateSearch();
        searchInput.focus();
      });
    })();
  </script>
  <script type="module" src="./public/dist/main.js"></script>
</body>
</html>
